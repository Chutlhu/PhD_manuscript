\chapter{Element of Room Acoustics}\label{chap:acoustics}

\newthought{Synopsis} This chapter blablabla

\section{Sound Wave Propagation}
What is sound? How is it perceived, how is it measured? How is it represented?

speed of sound

\begin{equation}
    \cair =  331.4 + 0.6\temperature + 0.0124\rhumidity \; \text{m/s}
    .
\end{equation}

\subsection{The Acoustic wave equation and it solution}
\label{subsec:acoustics:waveq}
acoustic wave equation governs the propagation of acoustic waves through a material medium.
The form of the equation is a second order partial differential equation.
The equation describes the evolution of acoustic pressure p or particle velocity v as a function of position x and time t.
A simplified form of the equation describes acoustic waves in only one spatial dimension, while a more general form describes waves in three dimensions.


a sound wave modifies the air particle locations, vibrating them from their mean position
The instantaneous vibration of these particles describes the wave behavior.
$\bfv = \klist{v_x, v_y, v_z}$ is the velocity of the particle vibrations in the 3D Cartesian coordinate system.
This movement of particles, generated by sound waves, also produces variations from the static air density $\densityEq$ and the air pressure P.

Conservation of momentum and conservation of mass

\newthought{Conservation of Momentum}

\marginpar{%
\footnotesize
Law I: Every body persists in its state of being at rest or of moving uniformly straight forward,
except insofar as it is compelled to change its state by force impressed.
\\Newton's original Latin reads: \emph{Lex I: Corpus omne perseverare in statu suo quiescendi vel movendi uniformiter in directum,
nisi quatenus a viribus impressis cogitur statum illum mutare}}

2nd Newton law
\sidenote{%
Law II: The alteration of motion is ever proportional to the motive force impress'd;
and is made in the direction of the right line in which that force is impress'd.
\\Orignal: \emph{Lex II: Mutationem motus proportionalem esse vi motrici impressae,
et fieri secundum lineam rectam qua vis illa imprimitur.}}

\begin{equation}
    F = m a
\end{equation}

\begin{equation}
    F = \kgrad{\pressure}
\end{equation}
$\kgrad$ denotes the three-dimensional gradient with, namely respect to space.

3nd Newton law and Conservation of momentum
\sidenote{%
Law III (action-reaction law): To every action there is always opposed an equal reaction:
or the mutual actions of two bodies upon each other are always equal, and directed to contrary parts
\\Original: \emph{Lex III: Actioni contrariam semper et æqualem esse reactionem:
sive corporum duorum actiones in se mutuo semper esse æquales et in partes contrarias dirigi.}}
writes
\begin{equation}
    \label{eq:acoustics:momentum}
    \kgrad{\pressure} = - \mass \kpderiv[]{\bfv}{t} = - \volumeUnit \kpderiv[]{\bfv}{t}
\end{equation}
where the mass $\mass$ is substituted by the density per unit volume $\volumeUnit$ since the unit of volume $V$ is considered as reference.

Evolution of sound pressure $\pressure (\positionMicrophone, t)$
as a function of position $\positionMicrophone = \klist{x, y, z}$ $[\si{\metre}]$ and time $t$ $[\si{\second}]$.

\newthought{Conservation of Mass}
\sidenote{Nothing comes from noting. In latin \textit{nihilo nihil fit} ---Parmenide}

In the field of fluid and continuous mechanics, the this law can be formulated mathematically using the \textit{continuity equation} in \textit{differential form}:
\begin{equation}
    \kpderiv[]{\rho}{t} + \kdivergence{\kparen{\rho \bfv}} = 0
    ,
\end{equation}
where $\rho$ is the density (mass per unit volume).


\begin{equation}
    \kpderiv[]{\eta}{t} + \eta_0 \kdivergence{\bfv} + = 0
    ,
\end{equation}

Considering the same unit of volume $V$, the conservation of mass law states that in a system that does not exchange
neither energy nor mass with the surrounding environment, the mass remains constant.
This is equivalent to say that the variation of mass inside $V$ is equal to the the amount of mass passing thought its volumetric surface, namely:


where $\knabla\cdot$ is the divergence operator, $\eta$ is the density (mass per unit volume) and $\bfv$ is flow velocity field.
where $\eta = \eta_0 + \Delta\eta$ is the total density within the volume accounting for the a static part $\eta_0$ and a variable part $\Delta\eta$.

The interpretation of the continuity equation for mass is the following: For a given closed surface in the system,
the change in time of the mass enclosed by the surface is equal to the mass that traverses the surface, positive if matter goes in and negative if matter goes out

By dividing the momentum conservation law in \cref{eq:acoustics:momentum} and differentiating both members with respect to space, it becomes:
\begin{equation}
    \kpderiv[]{}{t} \knabla\cdot \bfv = - \frac{1}{\volumeUnit} \knabla^2 p
\end{equation}



\marginpar{
    $\knabla^2 = \kpderiv[2]{}{x} + \kpderiv[2]{}{y} + \kpderiv[2]{}{z}$
    is the \textit{Laplacian} expressed  in  the  Cartesian  coordinates $\klist{x, y, z}$.
}
\begin{equation}
    \label{eq:acoustics:wave}
    \kpderiv[2]{\pressure(\positionMicrophone, t)}{t} = \cair^2 \knabla^2 \pressure(\positionMicrophone, t)
    ,
\end{equation}
where $\cair$ is the speed of sounds.

This equation is accurate as long as the sound field $\abs{\pressure(\positionMicrophone, t)} \ll \densityEq \cair^2$
where $\densityEq$ is the density of the propagation medium at equilibrium. It is not true when
\begin{itemize}
    \item scalar inhomogeneities (spatial distribution of sound speed or air density): temperature variation in the medium
    \item vector inhomogeneities (spatial distribution of particle mean velocity): presence of fans or air conditioning
\end{itemize}
In room acoustics this effects are too small, hence typically ignored.

Sound field from a source in a specific room, we need the source function and boundary condition that describes the sound reflection and absorption at the walls.
\begin{equation}
    \label{eq:acoustics:wave}
    \kpderiv[2]{\pressure(\positionMicrophone, t)}{t} - \cair^2 \knabla^2 \pressure(\positionMicrophone, t) = - \contSource(\positionMicrophone, t)
    ,
\end{equation}
where $\contSource(\positionMicrophone, t)$ denote the source function \cite{Room Impulse Response Generator, Habets}

By applying the Fourier Transform to \cref{eq:acoustics:wave}, we obtain the time-independent Helmholtz equation
\sidenote{\textbf{Helmholtz equation:} In mathematics, it is referred to the eigenvalue problem for the laplacian operator, that is.
$\knabla^2 f = - k^2 f$.  where $k$ is the eigenvalue, called \textit{wave number} in case of waves, and $f$ in the (eigen)function, \textit{amplitude} in case of wave.}:
\begin{equation}
    \knabla^2 P(\positionMicrophone ; f) + k^2 P(\positionMicrophone ; f) = 0
\end{equation}
where $k = \sfrac{2 \pi f}{\cair}$ is the \textit{wave number}, function of frequency $f$ and


In presence of a harmonic source producing waves described by the function $s(\positionMicrophone ; f)$, the propagation of its acoustic
signal (small amplitude, ideal (non-viscous)) in a fluid medium my be described by the following \textit{linear}, lossless, non-homogeneous wave equation
\begin{equation}
    \label{eq:acoustics:helmholtzSource}
    \knabla^2 p(t, \positionMicrophone) + \frac{1}{\cair^2} \kpderiv[2]{\pressure(\positionMicrophone, t)}{t} = s(t, \positionMicrophone).
\end{equation}

Threating the fluid medium as a \textit{linear filter}, this equation may be solved taking advantages of the signal and system theory.
We get the alternative solution to this problem (as compared with the conventional approach).

In the typical signal and system theory, the relation between the input (source) $x(t, \positionSource)$ and
the output $y(t', \positionMicrophone)$ is described by the following relation:

\begin{equation}
    \label{eq:acoustics:lti}
    y(t', \positionMicrophone) =
    \int \int
        h(t \kto  t' ; \positionSource \kto \positionMicrophone)
        x(t, \positionSource)
        \kdiff t  \kdiff \positionSource
\end{equation}

where $h(t \kto  t' ; \positionSource \kto \positionMicrophone)$ is the \textit{impulse response} of the linear filter, namely the response of the system
in the point with coordinates $\positionMicrophone$ at the time $t'$, if the unit-amplitude impulse was applied at the input at the time $t$ and location $\positionSource$.

By considering now the generic source function $s(t, \positionSource)$ as input function of the linear system and considering the pressure variation $\pressure$ as the output of the system,
we can rewrite \cref{eq:acoustics:lti} as follows:

\begin{equation}
    \label{eq:acoustics:lti:pressure}
    p(t', \positionMicrophone) =
    \int \int
        h(t \kto  t', \positionSource \kto \positionMicrophone)
        s(t, \positionSource)
        \kdiff t  \kdiff \positionSource
\end{equation}
The function $h(t \kto  t', \positionSource \kto \positionMicrophone)$ is the impulse response (Green's function)
along the transmission path between the source point $\positionSource$ and the receiver point $\positionSource$.

By applying the Fourier transform to both sides of equation \cref{eq:acoustics:helmholtzSource}, we obtain:
\begin{equation}
    \label{eq:acoustics:helmholtzSource}
    \knabla^2 P(f, \positionMicrophone) + \kparen{2 \pi f / \cair}^2 P(f, \positionMicrophone) = S(f, \positionMicrophone).
\end{equation}

where  $P(f, \positionMicrophone)$ is the Fourier transform of the pressure $\pressure$ and $f$ in the frequency in $\si{\hertz}$.

In the frequency domain, eq.~\cref{eq:acoustics:lti:pressure} writes

\begin{equation}
    P(f, \beta) = H(f, \beta) S(f, \beta)
\end{equation}


If a unit-amplitude harmonic point source at position $\positionSource$, $S(\positionMicrophone ; f) = \delta(\positionMicrophone - \positionSource)$,
where $\delta$ is the Kronecker delta function defining a point in the space.
The partial differential equation \cref{eq:acoustic:helmholtzSource} can be solved by first solving the following inhomogeneous equation:
\begin{equation}
    \knabla^2 G(\positionMicrophone ; f) + k^2 G(\positionMicrophone ; f) = - \delta(\positionMicrophone - \positionSource)
\end{equation}

where the the solution $G(\positionMicrophone ; f)$ is called \textit{Green's function}.

\subsection{The Green's Function as solution of the Wave Equation}

Why do we use Green's functions?
\cpother{Using the Green theorem, the integrated equation may be constructed,
linking the effect of action of the source, wave propagation,
boundary and initial conditions in the simple formula.}

Green's functions
\begin{itemize}
    \item used to solve initial- and boundary-value problems, involving differential equations [Duffy, 15]
    \item defined as impulse responses of homogeneous systems
\end{itemize}
Thus they are used to solve the sound wave equation for indoor propagation.

The solution of equation eq.~\cref{eq:acoustics:helmholtzSource} can be expressed in term of \textit{bundary conditions},
\textit{initial conditions} and the \textit{Green's function} $g$.
Such function is found by solving

\begin{equation}
    \knabla^2 g + \frac{1}{\cair^2} \kpderiv[2]{g}{t} = - \delta(\positionMicrophone - \positionSource)\delta(t - t_0)
\end{equation}
where $\positionSource$ is the position of the source.
This equation describes the effect of an impulse as it propagates from $\positionMicrophone=\positionSource$ as time increases form $t = t_0$.



% The Green's function $g({\bfx}_0, t_0, \bfx, t)$ is then the solution to the wave equation

% As in Duffy: Acoustic wave equation defined in \cref{eq:acoustics:wave}, can be rewritten
% \begin{equation}
%     \kderiv{2}{g}{t}
% \end{equation}

% The solution of the Helmholtz equation, describing the propagation of a wave in the free space
% The Green's function for a free (unbounded) space for an omnidirectional point sources is
% \begin{equation}
%     G(f, \bfx \mid {\bfx}_0) = - \frac{1}{4 \pi \norm{\bfx - {\bfx}_0}} e^{- \frac{\Ii  2 \pi f \norm{\bfx - {\bfx}_0}}{\cair}}
% \end{equation}

% The inverse Fourier Transform
% \begin{equation}
%     g(t, \bfx \mid {\bfx}_0) = - \frac{1}{4 \pi \norm{\bfx - {\bfx}_0}} \delta \kparen{t - \frac{\norm{\bfx -{\bfx}_0}}{\cair}}
% \end{equation}

% The Green's function for the sound wave equation will be here derived here:

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Acoustic Reflections}
\subsection{Specular reflections and Echoes}

\subsection{Scattering and Diffraction}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Room Acoustic Modeling and the Room Impulse Response}

\subsection{The Room Impulse Response and the Image Source Method}
https://reuk.github.io/wayverb/context.html

\newthought{Finally} we can write the final Room Impulse Response $\rir_{ij}(t)$ as follows:
\begin{equation}
    \contMicrophoneSignal(t) = (\rir_{ij} \conv \contSource)(t)
\end{equation}

\begin{equation}
    \rir_{ij}(t) = \sum_{r=0}^{R} \frac{\alpha_r}{4 \pi \tau_r / \cair} \delta \kparen{t - \tau_r}
\end{equation}
where
\begin{itemize}
    \item $\alpha_r \in \kintervcc{0}{1}$ is the attenuation coefficient of the $r$-th reflection
    \item $\tau_r = \norm{\positionMicrophone_\idxMic - \positionSource_\idxEch}$ is the distance between the microphone and the $\idxEch$-th image of source $\idxSrc$.
\end{itemize}

\newthought{The Image Source Method}


\subsection{The Acoustic Impulse Response}

\subsection{Properties of the Room Impulse Response}
\newthoughtpar{direct path}
\newthoughtpar{early echoes}
\newthoughtpar{late reverberation}

\subsection{Room Acoustic Simulators}
https://reuk.github.io/wayverb/context.html

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Acoustic Parameters and Perception}
\itodo{cite Sacks}
\newthoughtpar{The Mixing Time}
\newthoughtpar{Reverberation Time}
\newthoughtpar{Direct-to-revebrerant ratio}
\newthoughtpar{Critical Distance}
\newthoughtpar{Interchannel Coherence}
\newthoughtpar{Perception of the Early Reflection}
\newthoughtpar{Perception of the Late Reverberation}