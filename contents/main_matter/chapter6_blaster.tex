\chapter{Blaster: Knowledge-driven Acoustic Echo Retrieval}\label{chap:blaster}

% %Animals and humans have a remarkable ability to listen to the acoustic response of their environment.
% %Also known as \emph{echolocation} or \emph{bio-sonar}, it is used consciously and unconsciously to retrieve information about the environment and objects using sound waves.
% %Two (of the most) striking examples are bats and whales which use it as navigation and foraging mechanisms.

% %Striking introductive sentece
% In room acoustics and audio signal processing, the temporal structure of the room impulse response (RIR) plays a central role.
% % First echo is noise
% It is the result of multiple (indirect) sound propagation paths due to specular and diffuse reflections on the room's surfaces, leading to reverberation~\cite{Wang2011}.
% In such conditions, the perceived sound quality is often considered degraded and it is common to observe a detrimental decrease of performance as reverberation increases for applications such as speech recognition~\cite{Yoshoka2012} or music information retrieval~\cite{Barthet2010}.
% % or music virtual reality~\cite{DeMan2017}. %to observe a detrimental decrease of performances with reverberation. as well as music virtual reality~\cite{DeMan2017}.
% %\textcolor{red}{Add something about amazon echo, google assistant (analysis) and virtual reality (rendering/synthesis)}

% % Second echo is information
% On the other hand, RIRs contain very rich geometrical information about the acoustic scene.
% %which is independent from the source signal itself.
% %In contrast with well-consolidated methods,
% Recent \textit{echo-aware} works have shown that the knowledge of the timing of early reflections may boost performance in many audio signal processing applications, from dereverberation~\cite{Wu2006,Lin2008} to sound localization~\cite{Ribeiro2010,DiCarlo2019} and separation~\cite{Dokmanic2015a, Scheibler2017}.
% Moreover, it allows joint estimation of the receivers' positions~\cite{Salvati2016}, the reflective surfaces~\cite{Antonacci2012} and consequently the geometry of the room~\cite{Dokmanic2013, Crocco2017}.
% % or acoustic impedance of surfaces~\cite{Antonello2014, Bertin2016}.
% % beamforming \cite{Dockmanic2015},
% % such as for speech enhancement \cite{Wu2006}, source localization \cite{Ribeiro2010}, source separation \cite{Scheibler2017} and dereverberation \cite{Lin2009}
% % which are common pre-processing steps for many applications \cite{Gannot2017}

% Acoustic echo retrieval (AER) consists in estimating the properties of the early (strong) acoustic reflections only in multi-path environments~\cite{Tukuljac2018}, sometimes referred to as time delay estimation~\cite{Chen2006a}. To achieve this, several methods rely on a known source signal~\cite{park2017compressive,jensen2019method}.
% % Adding unknown adds a line :-(
% % yes, but it is really important
% % Got it. New mission: win space somewhere else in the paragraph?
% % no problem, I will pass throughthhtghththghth this
% % Seems legit
% In contrast, when multiple receivers attend an unknown single source, AER can be seen as an instance of Single Input Multiple Output (Blind) Channel Estimation (SIMO-BCE) problem.
% %or \textit{system identification}, \textit{i.e.} estimating the filters entailing an unknown input observed output of a system.
% %In a more challenging setting, when no prior information about the source signal are available, the problem is referred to as SIMO \textit{blind channel estimation} (SIMO-BCE) \cite{Lin2007}.
% A common approach for solving AER in the context of SIMO-BCE is to first blindly estimate a discrete version of the acoustic channels using the so-called cross-relation identity~\cite{Xu1995, Crocco2016}.
% The location of the echoes are then chosen among the strongest peaks with ad-hoc peak-picking techniques.
% %Such methods are generally \emph{on-grid} in the sense that the estimation relies on a fixed grid of points and \textit{a priori} chosen filter lengths.
% However, in practice, the true timings of echoes rarely match the sampling grid, thus leading to pathological issues called basis-mismatch in the field of compressed sensing.
% To circumvent this issue, the authors of~\cite{Tukuljac2018} proposed to leverage the framework of finite-rate-of-innovation sampling to make one step towards off-grid approaches.
% Despite promising results in the absence of noise and with synthetic data, the quality of the estimation highly relies on an initialization point.

% Of particular interest in this paper is the recently proposed framework of continuous dictionaries (CD)~\cite{Carlos2014}.
% By formulating an inverse problem as the recovery of a discrete measure over some parameter space, CD has allowed to overcome imaging device limitations in many applications such as super-resolution~\cite{Carlos2014} or PALM/STORM imaging~\cite{denoyelle2019}.
% In this work, we formulate the problem of stereo AER within the framework of continuous dictionaries.
% The resulting optimization problem is convex and thus not prone to spurious minimizers.
% The proposed method is coined \emph{Blind And Sparse Technique for Echo Retrieval} (\algoBraire) and requires no parameter tuning.
% The method is compared to state-of-the art on-grid approaches under various noise and reverberation levels using simulated data.
% While comparable or slightly worse recovery rates are observed for the task of recovering 7 echoes or more, better results are obtained for fewer echoes and the off-grid nature of the approach yields generally smaller estimation errors.

% \subsection{Signal and measurement model}

% Consider the common setup where a band-limited and square-integrable source signal $\contSource$ is emitted.
% Due to the geometry of the room, the latter signal is both reflected (several times) and attenuated before reaching a set of two microphones.
% The recorded signal at microphone $i\in\{1,2\}$ reads
% \begin{equation}
%     \label{eq:recordedSignal}
%     \contRecordedSignal_i = \contSource \ast \contFilter_i^\star + \contNoise_i
% \end{equation}
% where $\ast$ denotes the (continuous) convolution operator, $\contNoise_i$ models some additive noise in the measurement process and $\contFilter_i^\star$ denotes the room impulse response (RIR).
% In the remainder of this paper, the  superscript $\star$ refers to the ground truth.
% In AER, we are interested in RIRs that are streams of Diracs, \textit{i.e.},
% \begin{equation}
%     \label{eq:def_filter_star}
%     \contFilter_i^\star(t) = \sum_{r=0}^{R_i-1} c_{i,r} \delta(t - \tau_{i,r})
% \end{equation}
% where $R_i$ is the (unknown) number of echoes, $\kfamily{\tau_{i,r}}{r=0}^{R_i-1}$ models the echoes' delays, and $\kfamily{c_{i,r}}{r=0}^{R_i-1}$ are the corresponding non-negative attenuations.
% Note that $r=0$ defines the direct propagation path.
% %
% In the noiseless case, that is when $\contNoise_i=0$ for $i\in\{1,2\}$, we have the identity
% \begin{equation} \label{eq:cross-relation}
%     \contRecordedSignal_1 \ast \contFilter_2^\star = \contRecordedSignal_2 \ast \contFilter_1^\star
% \end{equation}
% by commutativity of the convolution operator.
% This result is dubbed cross-relation identity in the channel identification literature \cite{Xu1995}.
% Hence, one can expect to recover the two filters by solving an optimization problem involving~\eqref{eq:cross-relation}.
% %the difference between the two terms in~\eqref{eq:cross-relation}.

% However, in practice, only sampled versions of the two recorded signals are available.
% More precisely, we consider a  measurement model where the incoming signal undergoes a (ideal) low-pass filter $\idealLowPassFilter$ with frequency support $\kintervcc{\sfrac{-\SamplingFreq}{2}}{\sfrac{\SamplingFreq}{2}}$ before being regularly sampled at the rate  $\SamplingFreq$.
% We denote $\disRecordedSignal_1,\disRecordedSignal_2\in\kR^{2N}$ the two vectors of $2N$ (consecutive) samples and $i\in\{1, 2\}$ by
% \begin{equation}
%     \label{eq:measurement-process}
%     \disRecordedSignal_i[n] =
%     \kparen{\idealLowPassFilter \ast \contRecordedSignal}\kparen{\frac{n}{\SamplingFreq}}
%     \qquad
%     \forall n \in\{0, \dots, 2N-1\}
%     .
% \end{equation}
% %Let $\disRecordedSignal_1,\disRecordedSignal_2\in\kR^N$ denote the two vectors of $N$ consecutive samples that are such that $\disRecordedSignal_i[\ell] = \contRecordedSignal_i(\sfrac{\ell}{F_s})$ for $\ell\in\{1...N\}$, $i\in\{1, 2\}$ and  where $F_s$ is the sampling frequency.



% %We denote $\disRecordedSignal\in\kR^N$ the $N$ consecutive samples, \textit{i.e.}, such that $\disRecordedSignal[\ell] = \contRecordedSignal(\sfrac{\ell}{F_s})$ where $F_s$ is the sampling frequency.
% % These $N$ consecutive samples will be denoted  $\disRecordedSignal\in\kR^N$ and satifies $\disRecordedSignal[\ell] = \contRecordedSignal(\sfrac{\ell}{F_s})$ $\forall\ell\in\{1...N\}$ where $F_s$ is the sampling frequency.

% %the signals are notaccessible.  They are measured by sensors and discretized to be stored in a computerâ€™s memory.


% \subsection{Existing works}
% Starting from the identity \eqref{eq:cross-relation}, the common SIMO BCE cross-relation framework aims to compute $\contFilter_1, \contFilter_2$ solving the following LASSO-type problem in the discrete-time domain:
% \begin{multline}
%     \label{eq:xrel_toepl}
%     %\begin{split}
%     \disFilterHat_1, \disFilterHat_2
%     =
%     \kargmin_{\disFilter_1, \disFilter_2}
%     \;
%     \kvvbar{
%         \calT(\disRecordedSignal_1) \disFilter_2
%         -
%         \calT(\disRecordedSignal_2) \disFilter_1
%     }_2^2
%     +
%     \lambda
%     \kvvbar{
%         \disFilter
%     }_1
%     \\
%     %\quad
%     \text{s.t.} \quad \disFilter[0] = 1
%     \qquad
%     %\qquad
%     %\end{split}
% \end{multline}
% where $\disRecordedSignal_i$ and $\disFilter_i$ are the discrete, sampled version of $\contRecordedSignal_i, \contFilter_i$ respectively and $\disFilter = [\disFilter_1^\intercal, \disFilter_2^\intercal]$.
% $\calT(\disRecordedSignal_i)$ is the $(2N+L-1) \times L$ Toeplitz matrix\footnote{The first row and column of $\calT(\disRecordedSignal_i)$ are respectively $[\disRecordedSignal_i[2N-n], 0,\dotsc,0]$ and $[\disRecordedSignal_i[2N-n], \disRecordedSignal_i[2N-n+1],\dotsc,\disRecordedSignal_i[n], 0,\dotsc, 0]^\intercal$.} associated to convolution where $2N$ and $L$ respectively denote  microphone and filter signal length.
% The constraint $\disFilter[0]=1$ is called an anchor constraint.

% The accuracy of estimated RIRs has been subsequently improved using a priori knowledge of the filters: in particular, the authors of~\cite{Lin2007} have proposed to use sparsity penalty and non-negativity constraints to increase robustness to noise as well as Bayesian-learning methods to automatically infer the value of $\lambda$ in~\cite{Lin2008}.
% Even if sparsity and non-negativity could be seen as a strong assumption, works in speech enhancement~\cite{Ribeiro2010,Dokmanic2015a} and room geometry~\cite{Antonacci2012,Crocco2017} estimation have proven the effectiveness of this approach.
% On a similar scheme, in~\cite{Kowalczyk2013},~\eqref{eq:xrel_toepl} is solved using an adaptive time-frequency-domain approach while~\cite{Aissa-El-Bey2008} proposes to use the $\ell_p$-norm instead of the $\ell_1$-norm.
% A successful approach has been presented recently by Crocco \textit{et al.} in \cite{Crocco2016}, where the anchor constraint is replaced by an \textit{iterative weighted} $\ell_1$ equality constraint.
% %, \corrCE{ \textit{i.e.}, such that $\langle{\bfh^{(t-1)},\bfh^{(t)}}\rangle=1$ at each iteration $t$ where $\bfh^{(0)}$ is the solution of~\eqref{eq:xrel_toepl}.}

% %$\bfp^{(z)\intercal}\disFilter = 1$, for the iteration $(z)$\footnote{Note that when $\bfp^{(z)} = 1$, the constraint returns to the $\ell_1$ penalty.}. In particular, the method is initialized using the solution of \cite{Lin2007} and iterated enforcing sparsity using the solution of the previous problem, that is $\bfp^{(z)} = \disFilterHat^{(z-1)}$.

% %{\color{blue}
% %A Diego : ho scritto le seguenti frasi prima.
% %Non si adattano piu alla mia sezione.
% %Forse puoi farne uso:
% %\begin{itemize}
% %    \item Therefore, one may reasonably consider recovering $\contFilter_1$ and $\contFilter_2$ by solving an optimization problem involving the cross-relation identity.

% %    \item However, one would have to pay attention not selecting trivial solution such as $(\contFilterHat_1, \contFilterHat_2)=(0,0)$.

% %    \item To circumvent this issue, additional explicit constraints on the solution have been considered such as imposing a minimal energy~\cite{Kowalczyk2013} or weighted linear constraints~\cite{Crocco2016}.

% %    \item In this paper, we restrict our attention to the so-called \emph{anchor constrained} $\contFilter_1(0)=1$ which can be interpreted as choosing the origin of time.
% %\end{itemize}
% %}



% %\begin{itemize}
%     %\item Start from noiseless signal model

%     %\item Consider a setup where a \textcolor{blue}{band-limited?} and square-integrable source signal $\contSource$ is emitted.
%     %Due to the geometry of the room, the source $\contSource$ is  both reflected several times and attenuated before reaching a set of two microphones.

%     %\item The recorded signal at microphone $i\in\{1,2\}$ writes
%     %\begin{equation}
%     %    \label{eq:recordedSignal}
%     %    \contRecordedSignal_i = \contSource \ast \contFilter_i^\star + n_i
%     %\end{equation}
%     %where $\ast$ denotes the (continuous) convolution operator, $n_i=0$ models some additive noise in the measurements and $\contFilter_i$ denotes the Acoustic Impulse Response (AIR).

%     %\item Following the \textcolor{blue}{XXX model}, the AIR can be modeled using a stream of Dirac, that is
%     %\begin{equation}
%     %    \label{eq:def_filter_star}
%     %    \contFilter_i^\star(t) = \sum_{k=1}^{K_i} c_{i,k} \delta(t - \tau_{i,k})
%     %\end{equation}
%     %where $K_i$ is the (unknown) number of echoes, $\kfamily{\tau_{i,k}}{k=1}^{K_i}$ models the echo delay, and $\kfamily{c_{i,k}}{k=1}^{K_i}$ are the corresponding to attenuations.


%     %\item In the noiseless case, that is when $n_i=0$ for $i=1,2$, it has been noticed that $\contRecordedSignal_1 \ast \contFilter_2 = \contRecordedSignal_2 \ast \contFilter_1$ or, equivalently in the Fourier domain
%     %\begin{equation}
%     %    \label{eq:cross-relation-identity}
%     %    \calF[\contRecordedSignal_1] \cdot \calF[\contFilter_2^\star]
%     %    =
%     %    \calF[\contRecordedSignal_2] \cdot \calF[\contFilter_1^\star]
%     %\end{equation}
%     %by associativity of the convolution operator and where $\calF$ is such that\footnote{Note that we use the same notation when referring to the Fourier transform of a function and a distribution.}
%     %\begin{equation}
%     %    \kforall[f\in\kR]\quad \calF[y] =
%     %    \int_{-\infty}^{+\infty} y(t)\cste^{-\csti2\pi f t}\,\mathrm{d}t
% %        \kfuncdef{\calF}{L^2(\kR)}{L^2(\kR) \textcolor{blue}{\quad \text{a definir}}}[x][
%  %           \displaystyle
%  %           \kfamily{
%  %           f\mapsto \int_{-\infty}^{+\infty} x(t)\cste^{-\csti2\pi\ell t}\,\mathrm{d}t
%  %           }{\ell=-\infty}^{+\infty}
%  %           .
%  %       ]
%     %\end{equation}
%     %for all signal or filter $y$.
%     %The relation~\eqref{eq:cross-relation-identity} is dubbed \emph{cross-relation} identity in the acoustic literature~\textcolor{blue}{\cite[Correct?]{Tong1994}}, and may be considered as more convenient since it only involves matrix multiplications.
% %    \begin{equation}
% %        \label{eq:cross-relation-identity}
% %        \contRecordedSignal_1 \ast \contFilter_2 = \contRecordedSignal_2 \ast \contFilter_1
% %    \end{equation}




%     %\item Therefore, on may reasonably consider recovering $\contFilter_1$ and $\contFilter_2$ by solving an optimization problem involving the cross-relation identity.
%     %However, one would have to pay attention not selecting trivial solution such as $(\contFilterHat_1, \contFilterHat_2)=(0,0)$.
%     %To circumvent this issue, additional constraints on the solution has been considered, see for instance~\textcolor{blue}{?}.
%     %In this paper, we restrict our attention to the so-called \emph{anchor constrained} $\contFilter_1(0)=1$ which can be interpreted as choosing the origin of time.
%     %Hence one can expect recover $\contFilter_1^\star$ and $\contFilter_2^\star$ by solving
%     %\begin{equation}
%     %    \label{eq:ideal-infinite-problem}
%     %    \begin{split}
%     %    \contFilterHat_1, \contFilterHat_2
%     %    =
%     %    \kargmin_{\contFilter_1, \contFilter_2\in\textcolor{blue}{todo}}
%     %    \;
%     %    \kvvbar{
%     %        \calF[\contRecordedSignal_1] \cdot \calF[\contFilter_2]
%     %        -
%     %        \calF[\contRecordedSignal_2] \cdot \calF[\contFilter_1]
%     %    }_2^2
%     %    \\
%     %    \quad \text{s.t.} \quad \contFilter_1(0) = 1
%     %    . \qquad\qquad\qquad
%     %    \end{split}
%     %\end{equation}
%     %Indeed, one immediately sees that the couple $(\contFilter_1^\star,\contFilter_2^\star)$ is a minimizer of~\eqref{eq:ideal-infinite-problem}.

%     %\item Unfortunately, due to the measurement process, one has only access to a sampled version $\disRecordedSignal_i\in\kR^N$ of the recorded signal, or equivalently, the lower end of the spectrum of $\disRecordedSignal_i$.
%     %More precisely, the information we have about $\disRecordedSignal_i$ takes the form of the lowest $2N+1$ coefficients of the Fourier series given by
%     %\begin{equation}
%     %    \label{eq:dft-Xi}
%     %    X_i[f] = \sum_{n=0}^{N-1}
%     %    \contRecordedSignal_i(nT_e)
%     %    \cste^{-\csti2\pi fnT_e}
%     %\end{equation}
%     %where $X_i$ denotes the Discrete Fourier transform of $\contRecordedSignal_i$, $T_e$ is the sampling period and $f$ belongs to the \emph{finite} set of \emph{regularly-spaced} frequency $\kset{\frac{n}{T_e}}{n=0\dots N-1}$.



%     %\item The cross-relation identity~\eqref{eq:cross-relation-identity} remains nevertheless true for the $N$ available Fourier coefficients.\footnote{To be more precise, $2N-1$ coefficients are available. However, since the recorded signals $\contRecordedSignal_i$ are real, $N$ Fourier coefficients are sufficient to describe the Discrete Fourier Transform.}
%     %Whereas one could replace the Fourier transforms in~\eqref{eq:ideal-infinite-problem} by their Fourier series counterpart,
%     %the problem becomes ill posed since infinitely many solutions are available.



%     %\item \textcolor{blue}{What do we do with the door in time domain? in Mulan they say that $X_i$ is a good approximation of the FT as $N$ tends to infinity right?
%     %$\rightarrow$ sinus cardinal, has to be cancelled? could be done since the the source signal is assumed band limited with a correct sampling frequency}
% %\end{itemize}


% %!TEX root = ../icassp2020braire.tex

% %\textcolor{red}{Todo:
% %\begin{itemize}
%     %\item Find the correct number of Fourier coefficient
%     %
%     %\item Renormalized atom?
%     %\item Define what is a filter - function in the first section and measure in the second?
%     %Or directly talk about radon measure since the beginning?
%     %
%     %\item Introduce the CTDF of $\contFilter$ in the equation (instead of the Fourier transform)
%     %
%     %\item Introduce the dictionary before~\eqref{eq:TV-BP}.
% %\end{itemize}
% %}

% %\textcolor{blue}{What do we do with the door in time domain? in Mulan they say that $X_i$ is a good approximation of the FT as $N$ tends to infinity right?
% %$\rightarrow$ sinus cardinal, has to be cancelled? could be done since the the source signal is assumed band limited with a correct sampling frequency}




% %\remCE{TODO intro after related work is written}
% %All the methods presented above rely on a discrete formulation of the Cross-Relation identity~\eqref{eq:cross-relation}, thus relying on a T\oe{}plitz formulation of the convolution.
% %\remCE{Add drawbacks, such as on-the-grid}
% %In this work, we propose to circumvent this issue by casting the estimation problem in the \emph{continuous dictionaries} framework.


% \subsection{Cross-relation in the Fourier domain}

% \newcommand{\paramVec}[1]{\Delta_{#1}}

% We first remark that the cross-relation identity~\eqref{eq:cross-relation} ensures that the relation
% $   \idealLowPassFilter
%     \ast \contRecordedSignal_1
%     \ast  \contFilter_2^\star
%     =
%     \idealLowPassFilter
%     \ast \contRecordedSignal_2
%     \ast  \contFilter_1^\star
% $
% %by associativity of the convolution operator,
% %or equivalently
% holds, hence
% \begin{equation}
%     \label{eq:cross-relation-identity-fourier}
%     \fourierTrans(\idealLowPassFilter\ast\contRecordedSignal_1) \cdot \fourierTrans \contFilter_2^\star
%     =
%     \fourierTrans(\idealLowPassFilter\ast\contRecordedSignal_2) \cdot \fourierTrans \contFilter_1^\star
% \end{equation}
% where $\fourierTrans$ denotes the Fourier transform (FT)
% % and is such that %\footnote{}
%  \begin{equation}
%      \kforall[f \in\kR]\quad \fourierTrans y(f) =
%      \int_{-\infty}^{+\infty} y(t)\cste^{-\csti 2 \pi f t}\,\mathrm{d}t
%  \end{equation}
%  for any signal or filter $y$ (note that we use the same notation when referring to the Fourier transform of a function and a distribution).
% %We thus propose to use~\eqref{eq:cross-relation-identity-fourier} in a penalized least-square problem akin to~\eqref{eq:xrel_toepl}.
% %Such a formulation in the Fourier domain may even be considered as more convenient since the convolution operator is no longer involved.

% %\corrCE{In particular,~\eqref{eq:cross-relation-identity-fourier} remains true when evaluated at the set of regularly-spaced frequencies $0,1/\SamplingFreq\dots(N-1)/F_s$.}
% While the FT of $\contFilter_i^\star$ can be expressed in closed-form (see~\eqref{eq:closed-form-TF-dirac-N} below), the FT of $\idealLowPassFilter\ast\contRecordedSignal_i$ is not available due to the measurement process.
% To circumvent this issue, we use the %propose the following
% approximation
% %to approximate it by the discrete Fourier Transform of $\bfx$
% \begin{equation}
%     \label{eq:approx-TF}
%     \fourierTrans(\idealLowPassFilter\ast\contRecordedSignal_i)
%     %(\tfrac{f}{F_s})
%     (\tfrac{k}{2N}F_s)
%     \simeq
%     X_i[k]
% \end{equation}
% %for all $f\in\{0\dots N-1\}$
% % \corrRG{for all integers $f \in \{-N/2+1, \ldots, N/2\}$,}
% for all integers  $k \in \{0, \ldots, N\}$,
% where
% \begin{equation}
%     \label{eq:dft-Xi}
%     \RecordedSignalDFT_i[k] = \sum_{n=0}^{2N-1}
%     \bfx_i[n]
%     \cste^{-\csti2\pi \tfrac{kn}{2N}} %/\SamplingFreq}
% \end{equation}
% is the discrete Fourier transform of the real vector $\bfx_i$ for positive frequencies only.
% The FT of $\contFilter_1^\star,\contFilter_2^\star$ (see~\eqref{eq:def_filter_star}) can be expressed in closed-form.
% Denoting $\paramVec{\tau}$ the following parametric vector of complex exponential
% \begin{equation}
%     \label{eq:closed-form-TF-dirac-N}
%     \paramVec{\tau} \triangleq
%     %\corrRG{\triangleq}
%     \left(\cste^{-\csti2\pi\tfrac{k}{2N}F_s \tau}\right)_{0 \leq k \leq N}
%     %  \ktranspose{
%     %  \begin{pmatrix}
%     %      \cste^{-\csti2\pi\tfrac{0}{T_e}\tau} &
%     %      \hdots &
%     %      \cste^{-\csti2\pi\tfrac{N-1}{T_e}\tau}
%     %  \end{pmatrix}
%     % }
%     \in\kC^{N+1}
%     ,
% \end{equation}
% equation~\eqref{eq:cross-relation-identity-fourier} evaluated at $f = \frac{k}{2N}F_s$ where $k \in \{0,\ldots, N\}$
% reads

% \begin{equation}
%     \label{eq:cross-relation-approx}
%     \sum_{r=0}^{R_2-1}\bfX_1 \odot \paramVec{\tau_{2,r}}
%     =
%     \sum_{r=0}^{R_1-1}\bfX_2 \odot \paramVec{\tau_{1,r}}
% \end{equation}
% where $\odot$ denotes the component-wise Hadamard product.








% \subsection{Echo localization with continuous dictionaries}




% By interpreting the FT of a Dirac as a parametric atom, we propose to cast the problem of RIR estimation into the framework of continuous dictionaries.
% To that aim, let us define the so-called \emph{parameter set}
% \begin{equation}
%     \label{eq:parameter-set}
%     \Theta \triangleq \kintervcc{0}{T} \times \kbrace{1, 2}
% \end{equation}
% where $T$ is the length (in time) of the filter.
% %We let the reader check that $\Theta$ is a compact metrizable set.
% Then, the two desired filters  $\contFilter_1^\star,\contFilter_2^\star$ given  by~\eqref{eq:def_filter_star} can be uniquely\footnote{Uniqueness is ensured as soon as we impose $c_{i,r}>0$ $\forall i,r$.} represented by the following discrete measure over $\Theta$
% \begin{equation}
%     \label{eq:representation_filter_measure}
%     \mu^\star = \sum_{i=1}^{2} \sum_{r=0}^{R_{i}-1} c_{i,r} \delta_{(\tau_{i,r}, i)}.
% \end{equation}
% The rationale behind~\eqref{eq:parameter-set}  and~\eqref{eq:representation_filter_measure} is as follows.
% A couple of filters is now represented by a single stream of Diracs, where we have considered an augmented variable $i$ indicating to which filter the spike belongs.
% For instance, a Dirac at $(\tau, 1)$ indicates that the first filter contains a Dirac at $\tau$.
% %\remCE{rather talk about TDOA?}

% The set $\posDisRadonMeasure$ of all unsigned and discrete Radon measures over $\Theta$ (\textit{i.e.}, the set of all couples of  filters) is equipped with the total-variation norm (TV-norm) $\normTV{\mu}$.
% % defined for any measure $\mu$ as
% % \begin{equation}
% %     \normTV{\mu} \triangleq
% %     \sup_{P}\; \sum_{E\in P} \kvbar{
% %         \mu(E)
% %     }
% % \end{equation}
% % where the supremum is taken over all partitions $P$ of $\Theta$ into a finite number of disjoint measurable subsets.\footnote{See~\cite{Rudin1987} for a rigorous construction of measures set and the TV-norm.}
% See~\cite{Rudin1987} for a rigorous construction of measures set and the TV-norm.
% % In this work, we restrict our attention to the set $\posDisRadonMeasure$ of unsigned and discrete Radon measures \corrCE{-- \textit{i.e.}, linear combinations of Dirac with positive coefficients --} over $\Theta$ with \emph{finite} TV-norm.
% We now define the \emph{linear} observation operator $\kfuncdef{\opObs}{\posDisRadonMeasure}{\kC^{N+1}}$, which is such that
% \begin{equation}
%     \opObs\delta_{(\tau, i)}
%     =
%     \begin{cases}
%         - \RecordedSignalDFT_1 \odot \paramVec{\tau}  &\text{ if } i=1 \\
%         + \RecordedSignalDFT_2 \odot \paramVec{\tau}  &\text{ if } i=2.
%     \end{cases}
% \end{equation}
% $\forall(\tau,i)\in\Theta$ where the two complex vectors $\RecordedSignalDFT_1, \RecordedSignalDFT_2$ have been defined in~\eqref{eq:dft-Xi} and $\calF_N\delta_\tau$ in~\eqref{eq:closed-form-TF-dirac-N}.

% %and the minimization is carried over the space of finite Radon measures.
% Then, by linearity of the observation operator $\opObs$, the relation~\eqref{eq:cross-relation-approx} can be rewritten as %evaluated at the $N$ considered frequencies \corrCE{can be rewritten as}
% \begin{equation}
%     \label{eq:cross-relation-measure}
%     \opObs\mu^\star = {\bf0}_{N+1}
%     .
% \end{equation}
% Before continuing our exposition, we note that the anchor constraint can be written in a more convenient way.
% Indeed, the constraint $\mu(\{(0, 1)\})=1$ ensures the existence of a Dirac at $0$ in the filter 1.
% Then, the targeted filter reads
% \begin{equation}
%     \mu^\star = \delta_{(0, 1)} + \widetilde{\mu}^\star
% \end{equation}
% where $\widetilde{\mu}^\star$ is a (finite) discrete measure verifying  $\widetilde{\mu}^\star\kparen{\{(0, 1)\}} = 0$.
% Denoting $\bfy\triangleq-\opObs\delta_{(0, 1)}\in\kC^{N+1}$, the relation~\eqref{eq:cross-relation-measure} becomes
% \begin{equation}
%     \label{eq:cross-relation-measure-and-obs}
%     \opObs\widetilde{\mu}^\star = \bfy
%     .
% \end{equation}
% For the sake of clarity, we use these conventions hereafter and omit the tilde.
% Now, following~\cite{Castro2012aa,Carlos2014}, one can expect to recover the desired filter $\mu^\star$ by solving
% \begin{equation}
%     \stepcounter{equation}
%     \tag{\theequation-$\calP^0{\text{\texttt{TV}}}$}
%     \label{eq:TV-BP}
%     %\begin{split}
%     \widehat{\mu}
%     =
%     \kargmin_{\posDisRadonMeasure}
%     \;
%     \normTV{
%         \mu
%     }
%     %\\
%     %
%     \quad
%     \text{s.t.}
%     \quad
%     \begin{cases}
%         \opObs\mu
%         = \bfy \\
%         \mu(\{(0, 1)\}) = 0.
%     \end{cases}
%     %\end{split}
% \end{equation}
% Note that~\eqref{eq:TV-BP} has to be interpreted as a natural extension of the well-known \emph{basis pursuit} problem to the continuous setting.
% Indeed, for \emph{any} finite discrete measure $\mu = \sum_{r=0}^{R-1} c_r\delta_{(\tau_r, i_r)}$, the TV-norm of $\mu$ returns to the $\ell_1$-norm of the coefficients, \textit{i.e.}, $\kvvbar{\mu}_{TV} = \sum_{r=0}^{R-1} \kvbar{c_r}$.
% %\corrCE{To model the both}

% Finally,~\eqref{eq:cross-relation-measure-and-obs} can be exploited to take into account noise during the measurement process (\textit{i.e.},  $n_i\neq0$ in~\eqref{eq:recordedSignal}), as well as approximation errors  (see~\eqref{eq:approx-TF}-\eqref{eq:cross-relation-approx}).
% In that case, the first equality constraint in~\eqref{eq:TV-BP} is relaxed, leading to the so-called Beurling-LASSO (BLASSO) problem
% \begin{equation}
%     \stepcounter{equation}
%     \tag{\theequation-$\calP^\lambda_{\text{\texttt{TV}}}$}
%     \label{eq:TV-BLASSO}
%     \begin{split}
%     \widehat{\mu}
%     =
%     \kargmin_{\mu \in\posDisRadonMeasure}
%     \;
%     \tfrac{1}{2} \kvvbar{
%         \bfy - \opObs\mu
%     }_2^2
%     +
%     \lambda\normTV{
%         \mu
%     }
%     \\
%     %
%     \quad
%     \text{s.t.}
%     \quad
%     \mu(\{(0, 1)\}) = 0
%     .
%     \end{split}
% \end{equation}
% We emphasize that although continuous Radon measures may potentially be admissible, the minimizers of~\eqref{eq:TV-BLASSO} are \emph{guaranteed} to be streams of Dirac\textit{s}~\cite[Theorem~4.2]{bredies2018sparsity}.
% In addition, although problem~\eqref{eq:TV-BLASSO} seems to depend on some regularization parameter $\lambda$, we describe in Section~\ref{sec:xp} a procedure to automatically tune it to recover a desired number of spikes.

% Finally, note that problem~\eqref{eq:TV-BLASSO} is convex with linear constraints.
% %Hence, it can be solved with standard convex optimization methods.
% In this work, we particularize the sliding Frank-Wolfe algorithm proposed in~\cite{denoyelle2019} to solve~\eqref{eq:TV-BLASSO}.
% Detailed descriptions of the steps of the algorithm are given in \ifthenelse{\boolean{compmat}}{\Cref{sec:SFW}.}{\cite[App.~A]{DiCarlo2020SupMat}.}
% %the supplementary material\footnote{\url{https://gitlab.inria.fr/panama-team/blaster/blob/master/algorithm.pdf}.}.


% \begin{figure*}[ht]
%     \centering
%     %\begin{minipage}{0.49\textwidth}
%         \centering
%         \includegraphics[width=.49\textwidth]{figures/e_k-7_thr-2_bns_crocco_blaster.pdf}
%         %\caption{\label{fig:error} Error}
%     %\end{minipage}\hfill
%     %\begin{minipage}{0.49\textwidth}
%     %    \centering
%         \includegraphics[width=.49\textwidth]{figures/p_k-7_thr-2_bns_crocco_blaster.pdf}
%         %\caption{\label{fig:precision} Precision}
%     %\end{minipage}

%     \vspace*{2pt}
%     \begin{center}
%     \caption{
%         \label{fig:error_precision_snr_rt}
%     Line plot with error bands for error (left) and precision (right) versus SNR level (top) and \RT{} level (bottom) using broadband and speech signals for the task of recovering $R=7$ echoes. A threshold of $\tau_{\textrm{max}}=2$ samples is used to compute the precision.
%     %The performances are computed with respect to the corresponding datasets \dsetSNR{} and \dsetRT{} as explained Section~\ref{sec:xp}.
%     }
%     \end{center}
% \vspace{-3mm}
% \end{figure*}



% The proposed method (\algoBraire) is compared against the non-negative $\ell_1$-norm method (\algoBsn) of~\cite{Lin2007} and the iterative $\ell_1$-norm approach (\algoCrocco) described in~\cite{Crocco2016}.
% The problem is formulated as estimating the time location of the first $R=7$ strongest components of the RIRs for 2 microphones listening to a single sound source in a shoebox room. It corresponds to the challenging task of estimating
% %all the
% first-order early reflections.
% The robustness of the methods is tested against different level of noise (SNR) and reverberation time (\RT{}).

% We propose to compute a \textit{path of solutions} to automatically estimate the regularization parameter $\lambda$  in~\eqref{eq:TV-BLASSO}.
% More precisely, let $\lambda_{\max}$ be the smallest value of $\lambda$ such that the null measure is the solution to~\eqref{eq:TV-BLASSO}.
% It can be shown that $\lambda_{\max}$ is upper bounded by $\max_{\theta\in\Theta} \kvbar{\bfy^\intercal\opObs\delta_\theta}$.
% Starting from $\ell=1$ and the empty filter, we consider a sequential implementation where the solution of~\eqref{eq:TV-BLASSO} is computed for $\lambda_\ell= 10^{-0.05\ell}\lambda_{\max}$ until the desired number of spikes is found in each channel when incrementing $\ell$.
% For each $\lambda_\ell$, we search for a solution of~\eqref{eq:TV-BLASSO} with the solution obtained for $\lambda_{\ell-1}$ as a warm start.

% The quality of the AER estimation is assessed in terms of precision\footnote{Since only $K$ time locations are considered in both the ground truth and the estimation, precision and recall are equal.} in percentage as in the literature of onset detection~\cite{Bock2012} and the root-mean-square-error (RMSE) in samples.
% Both metrics evaluate only the \textit{matched} peaks, where a \textit{match} is defined as being within a small window $\thr$ of a reference delay. These two metrics are similar to the ones used in~\cite{Crocco2015}.

% For this purpose we created three synthetic datasets of $1000$ observations each:
% %As summarized in Table~\ref{tab:datasets},
% \dsetValid{} is used for tuning the hyperparameter $\lambda$ and the peak-picking parameters for \algoCrocco{} and \algoBsn{} using \RT{} and SNR randomly drawn from $\mathcal{U}[0, 1]$ (sec) and $\mathcal{U}[0, 20]$ (dB) respectively; \dsetSNR{} features SNR value uniformly sampled in $[0, 6, 14, 20, \infty]$ while the \RT{} is kept fixed to $400$ ms; akin the \dsetRT{} is built sampling \RT{} value uniformly in $[200, 400, 600, 800, 1000]$ ms keeping SNR fix to 20 dB.
% Moreover, while for \dsetValid{} broadband signals (white noise) are used as the source, for \dsetSNR{} and \dsetRT{} speech utterances from the TIMIT dataset are also included.
% The signal duration is kept fixed to 1 s with sampling frequency $\Fs = 16$ kHz.


% For a given \RT{} value and room with random dimensions, a unique absorption coefficient is assigned to all surfaces based on the Sabine's formula. Then, the two microphones and the source are randomly positioned inside the room. The parameters of such audio scene are then passed as input to the \texttt{pyroomacoustic} simulator~\cite{Scheibler_2018}, which returns the corresponding RIRs as well as the \textit{off-grid} echo delays and attenuation coefficients computed with the Image Method~\cite{Allen1979}.
% Note that when generating the data, no samples have been pruned to match any minimal separation condition.

% To generate the microphone signals, an oversampled version of the source signal is convolved with ideal RIRs at high frequency ($\Fs=1024$ kHz) made up of on-grid Dirac\textit{s}. The results are later resampled to meet the original $\Fs$ and Gaussian white noise is added to meet the given SNR value.

% %Details of the data generation are reported in~\ref{algo:data-generation}.

% \begin{table}[ht]
%     \centering
%     \input{tables/table_different_thr.tex}
%     \caption{\label{tab:error_precision_thr} Precision for different threshold $\thr$ in samples for the recovery of $R = 2$ and $7$ echoes, \RT{} = $200$ ms and SNR = 20 dB.}
% \end{table}

% \begin{figure}[t!]
%     \centering
%         \includegraphics[width=\linewidth]{figures/p_k-7_thr-2_bns_crocco_blaster-peak_withRechoes.pdf}
%         \caption{\label{fig:error_precision_kecho}  Line plots with error bands of precision versus number of echoes $R$ to be retrieved for broadband (left) and speech (right) signals with \RT{} = $400$ ms and SNR = 20 dB.}
% \end{figure}





% Quantitative results are reported in Fig.~\ref{fig:error_precision_snr_rt}, Fig.~\ref{fig:error_precision_kecho} and Tab.~\ref{tab:error_precision_thr}. Here, for both RMSE and Precision and for both broadband and speech signal, the metrics are displayed against the dataset parameters. We observe that \algoBsn{} performs worst in all tested conditions, possibly due to its strong reliance on the peak picking step. For $R=7$ or higher, \algoBraire{} yields similar or slightly worse performance than \algoCrocco{} for the considered noise and reverberation levels, with decreasing performance for both as these levels increase. Using speech rather than broadband signals also yields worse results for all methods. However, the echo timing RMSE is significantly smaller using \algoBraire{} due to its off-grid advantage. We also note that \algoBraire{} significantly outperforms \algoCrocco{} on the task of recovering $R=2$ echoes. As showed in Tab.~\ref{tab:error_precision_thr}, in mild conditions, up to 68\% of echoes can be retrieved by \algoBraire{} with errors lower than half a sample in that case. This is promising since the practical advantage of knowing the timing of two echoes per channel has been demonstrated in~\cite{DiCarlo2019,Scheibler2017}.

% % Crocco-like short conclusion
% A novel blind, off-grid, multichannel echo retrieval method has been proposed based on the framework of continuous dictionaries.
% Comparisons with state-of-the-art approaches on various noise and reverberation conditions show that this method performs best when the number of echoes to retrieve is small.
% While some robustness to noise, reverberation, and non-broadband signals is observed, our experiments reveal that room for improvement exists for this challenging and emerging topic.
% Future works will include an extension to more than two channels and experiments on real-world data.
